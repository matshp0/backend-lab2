generator kysely {
  provider        = "prisma-kysely"
  output          = "../src/db"
  fileName        = "types.ts"
  enumFileName    = "enums.ts"
  previewFeatures = ["postgresqlExtensions"]
}

datasource db {
  provider   = "postgresql"
  url        = env("DATABASE_URL")
  extensions = [uuidOssp(map: "uuid-ossp")]
}

model currency {
  code          String @id @db.Char(3)
  name          String
  symbol        String
  decimalPlaces Int    @default(2) @db.SmallInt

  users   user[]   @relation("userDefaultCurrency")
  records record[] @relation("recordCurrency")

  @@map("currency")
}

model category {
  id      String   @id @default(dbgenerated("uuid_generate_v4()"))
  name    String
  records record[] @relation("categoryRecords")
}

model user {
  id                  String   @id @default(dbgenerated("uuid_generate_v4()")) @db.Uuid
  name                String
  email               String   @unique
  password            String
  defaultCurrencyCode String   @db.Char(3)
  records             record[] @relation("userRecords")
  defaultCurrency     currency @relation("userDefaultCurrency", fields: [defaultCurrencyCode], references: [code])
}

model record {
  id           String   @id @default(dbgenerated("uuid_generate_v4()")) @db.Uuid
  createdAt    DateTime @default(now()) @db.Timestamp(6)
  userId       String   @db.Uuid
  categoryId   String
  cost         Decimal  @db.Decimal
  currencyCode String   @db.Char(3)

  category category @relation("categoryRecords", fields: [categoryId], references: [id], onUpdate: NoAction, map: "fk_record_category")
  user     user     @relation("userRecords", fields: [userId], references: [id], onDelete: Cascade, onUpdate: NoAction, map: "fk_record_user")
  currency currency @relation("recordCurrency", fields: [currencyCode], references: [code])
}
